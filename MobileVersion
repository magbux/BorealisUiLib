--[[
    BOREALIS UI LIBRARY
    Mobile Friendly | Animated | High Performance
    
    Designed for GitHub hosting.
    Author: [Your Name]
]]

local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local Mouse = LocalPlayer:GetMouse()

local Library = {
    Version = "1.0.0",
    Windows = {}
}

--// Theme Configuration
local Theme = {
    Background = Color3.fromRGB(18, 20, 28),
    Header = Color3.fromRGB(24, 26, 35),
    Sidebar = Color3.fromRGB(24, 26, 35),
    Element = Color3.fromRGB(30, 32, 42),
    Text = Color3.fromRGB(240, 240, 240),
    TextDim = Color3.fromRGB(140, 140, 150),
    Gradient1 = Color3.fromRGB(45, 205, 255), -- Cyan
    Gradient2 = Color3.fromRGB(165, 55, 255), -- Purple
}

--// Utility Functions
local function Create(instance, properties, children)
    local obj = Instance.new(instance)
    for i, v in pairs(properties or {}) do
        obj[i] = v
    end
    for _, child in pairs(children or {}) do
        child.Parent = obj
    end
    return obj
end

local function Tween(obj, info, props)
    TweenService:Create(obj, TweenInfo.new(info, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), props):Play()
end

local function GetGuiParent()
    local success, coreGui = pcall(function() return game:GetService("CoreGui") end)
    if success and coreGui then
        return coreGui
    end
    return LocalPlayer:WaitForChild("PlayerGui")
end

--// Draggable Logic (Mobile & PC)
local function MakeDraggable(topbar, object)
    local dragging, dragInput, dragStart, startPos

    local function update(input)
        local delta = input.Position - dragStart
        local target = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        TweenService:Create(object, TweenInfo.new(0.05), {Position = target}):Play()
    end

    topbar.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            dragStart = input.Position
            startPos = object.Position
            
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)

    topbar.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
            dragInput = input
        end
    end)

    UserInputService.InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            update(input)
        end
    end)
end

--// Main Window Function
function Library:Window(options)
    local TitleText = options.Name or "Borealis"
    local GuiName = "BorealisLib_" .. tostring(math.random(10000, 99999))
    
    -- Cleanup Old UI
    for _, gui in pairs(GetGuiParent():GetChildren()) do
        if gui.Name:match("BorealisLib_") then gui:Destroy() end
    end

    local ScreenGui = Create("ScreenGui", {
        Name = GuiName,
        Parent = GetGuiParent(),
        ZIndexBehavior = Enum.ZIndexBehavior.Sibling,
        ResetOnSpawn = false
    })

    -- Main Container
    local Main = Create("Frame", {
        Name = "Main",
        Parent = ScreenGui,
        BackgroundColor3 = Theme.Background,
        Position = UDim2.new(0.5, -225, 0.5, -160),
        Size = UDim2.new(0, 450, 0, 320),
        BorderSizePixel = 0,
        ClipsDescendants = true
    }, {
        Create("UICorner", {CornerRadius = UDim.new(0, 8)}),
        Create("UIStroke", {Color = Theme.Header, Thickness = 2, Transparency = 0.5})
    })

    -- Header
    local Header = Create("Frame", {
        Name = "Header",
        Parent = Main,
        BackgroundColor3 = Theme.Header,
        Size = UDim2.new(1, 0, 0, 45),
        BorderSizePixel = 0
    }, {
        Create("UICorner", {CornerRadius = UDim.new(0, 8)}),
        -- Fix bottom corners
        Create("Frame", {
            BackgroundColor3 = Theme.Header,
            Size = UDim2.new(1, 0, 0, 10),
            Position = UDim2.new(0,0,1,-10),
            BorderSizePixel = 0
        }),
        -- Title
        Create("TextLabel", {
            Text = TitleText,
            TextColor3 = Theme.Text,
            TextSize = 18,
            Font = Enum.Font.GothamBold,
            BackgroundTransparency = 1,
            Size = UDim2.new(1, -60, 1, 0),
            Position = UDim2.new(0, 15, 0, 0),
            TextXAlignment = Enum.TextXAlignment.Left,
            Children = {
                Create("UIGradient", {
                    Color = ColorSequence.new{
                        ColorSequenceKeypoint.new(0, Theme.Gradient1),
                        ColorSequenceKeypoint.new(1, Theme.Gradient2)
                    }
                })
            }
        })
    })

    MakeDraggable(Header, Main)

    -- Sidebar (Tabs)
    local Sidebar = Create("ScrollingFrame", {
        Name = "Sidebar",
        Parent = Main,
        BackgroundColor3 = Theme.Sidebar,
        Position = UDim2.new(0, 0, 0, 45),
        Size = UDim2.new(0, 110, 1, -45),
        BorderSizePixel = 0,
        ScrollBarThickness = 0,
        CanvasSize = UDim2.new(0,0,0,0) -- Automatic
    }, {
        Create("UIListLayout", {
            SortOrder = Enum.SortOrder.LayoutOrder,
            Padding = UDim.new(0, 5)
        }),
        Create("UIPadding", {PaddingTop = UDim.new(0, 10), PaddingLeft = UDim.new(0, 5)})
    })

    -- Content Area
    local Container = Create("Frame", {
        Name = "Container",
        Parent = Main,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 110, 0, 45),
        Size = UDim2.new(1, -110, 1, -45)
    })

    -- Floating Toggle Button (Mobile Essential)
    local ToggleBtn = Create("TextButton", {
        Name = "Toggle",
        Parent = ScreenGui,
        BackgroundColor3 = Theme.Header,
        Position = UDim2.new(0.05, 0, 0.15, 0),
        Size = UDim2.new(0, 40, 0, 40),
        Text = "",
        AutoButtonColor = false
    }, {
        Create("UICorner", {CornerRadius = UDim.new(1, 0)}),
        Create("UIStroke", {Color = Theme.Gradient1, Thickness = 2, Transparency = 0.3}),
        Create("ImageLabel", {
            BackgroundTransparency = 1,
            Image = "rbxassetid://3926305904", -- Settings Icon
            Size = UDim2.new(0, 24, 0, 24),
            Position = UDim2.new(0.5, -12, 0.5, -12),
            ImageColor3 = Theme.Text
        })
    })
    
    MakeDraggable(ToggleBtn, ToggleBtn)

    local isVisible = true
    ToggleBtn.MouseButton1Click:Connect(function()
        isVisible = not isVisible
        if isVisible then
            Main:TweenSize(UDim2.new(0, 450, 0, 320), "Out", "Back", 0.3, true)
        else
            Main:TweenSize(UDim2.new(0, 450, 0, 0), "In", "Quad", 0.2, true)
        end
    end)

    --// Tab Handling
    local TabHandler = {}
    local firstTab = true

    function TabHandler:Tab(name)
        -- Tab Button
        local TabBtn = Create("TextButton", {
            Parent = Sidebar,
            BackgroundColor3 = Theme.Background,
            Text = name,
            TextColor3 = Theme.TextDim,
            Font = Enum.Font.GothamMedium,
            TextSize = 13,
            Size = UDim2.new(1, -10, 0, 32),
            AutoButtonColor = false,
            BorderSizePixel = 0
        }, {
            Create("UICorner", {CornerRadius = UDim.new(0, 6)})
        })

        -- Tab Page
        local Page = Create("ScrollingFrame", {
            Parent = Container,
            BackgroundTransparency = 1,
            Size = UDim2.new(1, 0, 1, 0),
            ScrollBarThickness = 2,
            ScrollBarImageColor3 = Theme.Gradient1,
            Visible = false,
            BorderSizePixel = 0
        }, {
            Create("UIListLayout", {
                SortOrder = Enum.SortOrder.LayoutOrder,
                Padding = UDim.new(0, 6)
            }),
            Create("UIPadding", {
                PaddingTop = UDim.new(0, 10),
                PaddingLeft = UDim.new(0, 10),
                PaddingRight = UDim.new(0, 10),
                PaddingBottom = UDim.new(0, 10)
            })
        })

        -- Resize Logic
        Page.UIListLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
            Page.CanvasSize = UDim2.new(0, 0, 0, Page.UIListLayout.AbsoluteContentSize.Y + 20)
        end)

        -- Select Logic
        if firstTab then
            firstTab = false
            TabBtn.BackgroundColor3 = Theme.Element
            TabBtn.TextColor3 = Theme.Text
            Page.Visible = true
        end

        TabBtn.MouseButton1Click:Connect(function()
            -- Reset all tabs
            for _, v in pairs(Sidebar:GetChildren()) do
                if v:IsA("TextButton") then
                    Tween(v, 0.2, {BackgroundColor3 = Theme.Background, TextColor3 = Theme.TextDim})
                end
            end
            for _, v in pairs(Container:GetChildren()) do
                if v:IsA("ScrollingFrame") then v.Visible = false end
            end
            
            -- Active State
            Tween(TabBtn, 0.2, {BackgroundColor3 = Theme.Element, TextColor3 = Theme.Text})
            Page.Visible = true
        end)

        --// Element Handling
        local ElementHandler = {}

        function ElementHandler:Label(text)
            Create("TextLabel", {
                Parent = Page,
                BackgroundTransparency = 1,
                Text = text,
                TextColor3 = Theme.TextDim,
                TextSize = 12,
                Font = Enum.Font.GothamBold,
                Size = UDim2.new(1, 0, 0, 20),
                TextXAlignment = Enum.TextXAlignment.Left
            })
        end

        function ElementHandler:Button(text, callback)
            local Btn = Create("TextButton", {
                Parent = Page,
                BackgroundColor3 = Theme.Element,
                Text = text,
                TextColor3 = Theme.Text,
                Font = Enum.Font.Gotham,
                TextSize = 14,
                Size = UDim2.new(1, 0, 0, 36),
                AutoButtonColor = false,
                BorderSizePixel = 0
            }, {
                Create("UICorner", {CornerRadius = UDim.new(0, 6)})
            })

            Btn.MouseButton1Click:Connect(function()
                Tween(Btn, 0.1, {BackgroundColor3 = Theme.Gradient1, TextColor3 = Color3.new(0,0,0)})
                task.wait(0.1)
                Tween(Btn, 0.1, {BackgroundColor3 = Theme.Element, TextColor3 = Theme.Text})
                pcall(callback)
            end)
        end

        function ElementHandler:Toggle(text, default, callback)
            local enabled = default or false
            local Toggler = Create("TextButton", {
                Parent = Page,
                BackgroundColor3 = Theme.Element,
                Text = "",
                Size = UDim2.new(1, 0, 0, 36),
                AutoButtonColor = false,
                BorderSizePixel = 0
            }, {
                Create("UICorner", {CornerRadius = UDim.new(0, 6)}),
                Create("TextLabel", {
                    BackgroundTransparency = 1,
                    Text = text,
                    TextColor3 = Theme.Text,
                    Font = Enum.Font.Gotham,
                    TextSize = 14,
                    Size = UDim2.new(0.7, 0, 1, 0),
                    Position = UDim2.new(0, 10, 0, 0),
                    TextXAlignment = Enum.TextXAlignment.Left
                })
            })

            local Switch = Create("Frame", {
                Parent = Toggler,
                BackgroundColor3 = Theme.Background,
                Size = UDim2.new(0, 36, 0, 20),
                Position = UDim2.new(1, -46, 0.5, -10)
            }, {
                Create("UICorner", {CornerRadius = UDim.new(1, 0)}),
                Create("UIStroke", {Color = Theme.TextDim, Thickness = 1, Transparency = 0.5})
            })

            local Knob = Create("Frame", {
                Parent = Switch,
                BackgroundColor3 = Theme.TextDim,
                Size = UDim2.new(0, 16, 0, 16),
                Position = UDim2.new(0, 2, 0.5, -8)
            }, {
                Create("UICorner", {CornerRadius = UDim.new(1, 0)})
            })

            local function UpdateToggle()
                if enabled then
                    Tween(Switch, 0.2, {BackgroundColor3 = Theme.Gradient1})
                    Tween(Knob, 0.2, {Position = UDim2.new(1, -18, 0.5, -8), BackgroundColor3 = Color3.new(1,1,1)})
                    Switch.UIStroke.Transparency = 1
                else
                    Tween(Switch, 0.2, {BackgroundColor3 = Theme.Background})
                    Tween(Knob, 0.2, {Position = UDim2.new(0, 2, 0.5, -8), BackgroundColor3 = Theme.TextDim})
                    Switch.UIStroke.Transparency = 0.5
                end
            end
            
            -- Initial State
            if enabled then UpdateToggle() end

            Toggler.MouseButton1Click:Connect(function()
                enabled = not enabled
                UpdateToggle()
                pcall(callback, enabled)
            end)
        end

        function ElementHandler:Slider(text, min, max, default, callback)
            local SliderVal = default or min
            local SliderFrame = Create("Frame", {
                Parent = Page,
                BackgroundColor3 = Theme.Element,
                Size = UDim2.new(1, 0, 0, 50)
            }, {
                Create("UICorner", {CornerRadius = UDim.new(0, 6)})
            })

            Create("TextLabel", {
                Parent = SliderFrame,
                BackgroundTransparency = 1,
                Text = text,
                TextColor3 = Theme.Text,
                Font = Enum.Font.Gotham,
                TextSize = 14,
                Position = UDim2.new(0, 10, 0, 5),
                Size = UDim2.new(1, -20, 0, 20),
                TextXAlignment = Enum.TextXAlignment.Left
            })

            local ValueText = Create("TextLabel", {
                Parent = SliderFrame,
                BackgroundTransparency = 1,
                Text = tostring(SliderVal),
                TextColor3 = Theme.Gradient1,
                Font = Enum.Font.GothamBold,
                TextSize = 14,
                Position = UDim2.new(1, -60, 0, 5),
                Size = UDim2.new(0, 50, 0, 20),
                TextXAlignment = Enum.TextXAlignment.Right
            })

            local Bar = Create("TextButton", { -- TextButton for touch input
                Parent = SliderFrame,
                BackgroundColor3 = Theme.Background,
                Position = UDim2.new(0, 10, 0, 32),
                Size = UDim2.new(1, -20, 0, 6),
                Text = "",
                AutoButtonColor = false
            }, {
                Create("UICorner", {CornerRadius = UDim.new(1, 0)})
            })

            local Fill = Create("Frame", {
                Parent = Bar,
                BackgroundColor3 = Theme.Gradient1,
                Size = UDim2.new((SliderVal - min) / (max - min), 0, 1, 0)
            }, {
                Create("UICorner", {CornerRadius = UDim.new(1, 0)})
            })

            local dragging = false
            local function Update(input)
                local pos = UDim2.new(math.clamp((input.Position.X - Bar.AbsolutePosition.X) / Bar.AbsoluteSize.X, 0, 1), 0, 1, 0)
                Fill:TweenSize(pos, "Out", "Quad", 0.1, true)
                local val = math.floor(((pos.X.Scale * (max - min)) + min))
                ValueText.Text = tostring(val)
                pcall(callback, val)
            end

            Bar.InputBegan:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                    dragging = true
                    Update(input)
                end
            end)

            UserInputService.InputEnded:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                    dragging = false
                end
            end)

            UserInputService.InputChanged:Connect(function(input)
                if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
                    Update(input)
                end
            end)
        end

        function ElementHandler:Dropdown(text, options, callback)
            local dropped = false
            local DropFrame = Create("TextButton", {
                Parent = Page,
                BackgroundColor3 = Theme.Element,
                Text = "",
                Size = UDim2.new(1, 0, 0, 36),
                AutoButtonColor = false,
                ClipsDescendants = true
            }, {
                Create("UICorner", {CornerRadius = UDim.new(0, 6)})
            })

            local Label = Create("TextLabel", {
                Parent = DropFrame,
                BackgroundTransparency = 1,
                Text = text .. "...",
                TextColor3 = Theme.Text,
                Font = Enum.Font.Gotham,
                TextSize = 14,
                Position = UDim2.new(0, 10, 0, 0),
                Size = UDim2.new(1, -40, 0, 36),
                TextXAlignment = Enum.TextXAlignment.Left
            })

            local Icon = Create("TextLabel", {
                Parent = DropFrame,
                BackgroundTransparency = 1,
                Text = "â–¼",
                TextColor3 = Theme.TextDim,
                TextSize = 12,
                Position = UDim2.new(1, -30, 0, 0),
                Size = UDim2.new(0, 30, 0, 36)
            })

            local ListLayout = Create("UIListLayout", {
                Parent = DropFrame,
                SortOrder = Enum.SortOrder.LayoutOrder,
                Padding = UDim.new(0, 2)
            })
            
            -- Padding for list
            Create("UIPadding", {Parent = DropFrame, PaddingTop = UDim.new(0, 36), PaddingLeft = UDim.new(0, 5), PaddingRight = UDim.new(0, 5), PaddingBottom = UDim.new(0,5)})

            local function RefreshSize()
                if dropped then
                    local count = #options
                    DropFrame:TweenSize(UDim2.new(1, 0, 0, 36 + (count * 32) + 10), "Out", "Quad", 0.2, true)
                    Tween(Icon, 0.2, {Rotation = 180})
                else
                    DropFrame:TweenSize(UDim2.new(1, 0, 0, 36), "Out", "Quad", 0.2, true)
                    Tween(Icon, 0.2, {Rotation = 0})
                end
            end

            -- Create Option Buttons
            for _, opt in pairs(options) do
                local OptBtn = Create("TextButton", {
                    Parent = DropFrame,
                    BackgroundColor3 = Theme.Background,
                    Text = opt,
                    TextColor3 = Theme.TextDim,
                    Font = Enum.Font.Gotham,
                    TextSize = 13,
                    Size = UDim2.new(1, 0, 0, 30),
                    AutoButtonColor = false
                }, {
                    Create("UICorner", {CornerRadius = UDim.new(0, 4)})
                })
                
                OptBtn.MouseButton1Click:Connect(function()
                    Label.Text = text .. ": " .. opt
                    dropped = false
                    RefreshSize()
                    pcall(callback, opt)
                end)
            end

            DropFrame.MouseButton1Click:Connect(function()
                dropped = not dropped
                RefreshSize()
            end)
        end

        return ElementHandler
    end
    return TabHandler
end

return Library
